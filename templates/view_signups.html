<!--
    This HTML template displays a user's signups.
    It shows different information and functionality based on whether the user
    is a volunteer or an organization.
    - Organizations can view all signups for their events.
    - Volunteers can view their own signups.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Signups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .signup-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .signup-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .table-header th {
            padding: 1rem;
            text-align: left;
            border-bottom: 2px solid #e5e7eb;
            background-color: #f9fafb;
        }
        .table-row td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="bg-emerald-500 text-white p-6 text-center rounded-b-xl shadow-lg">
        <h1 class="text-4xl font-bold">Community Connect: Volunteer Management System</h1>
        <p class="mt-2 text-xl font-light">Connecting Volunteers, Organisations, and Events</p>
    </header>

    <!-- Navigation Bar -->
    <nav class="bg-gray-800 p-2 text-center shadow-md">
        <div class="max-w-4xl mx-auto flex justify-center space-x-6">
            <a href="/" class="text-white hover:text-emerald-300 font-medium transition-colors">Home</a>
            <a href="/organisations" class="text-white hover:text-emerald-300 font-medium transition-colors">View Organisations</a>
            <a href="/events" class="text-white hover:text-emerald-300 font-medium transition-colors">View Upcoming Events</a>
            <a href="/volunteers" class="text-white hover:text-emerald-300 font-medium transition-colors">View Volunteers</a>
            {% if session.get("user_type") == "volunteer" %}
                <a href="/signups" class="text-emerald-300 font-bold transition-colors">My Signups</a>
                <a href="/edit_profile" class="text-white hover:text-emerald-300 font-medium transition-colors">Edit Profile</a>
                <a href="/logout" class="text-white hover:text-emerald-300 font-medium transition-colors">Log Out</a>
            {% elif session.get("user_type") == "organisation" %}
                <a href="/signups" class="text-emerald-300 font-bold transition-colors">Signups</a>
                <a href="/edit_profile" class="text-white hover:text-emerald-300 font-medium transition-colors">Edit Profile</a>
                <a href="/logout" class="text-white hover:text-emerald-300 font-medium transition-colors">Log Out</a>
            {% else %}
                <a href="/signup" class="text-white hover:text-emerald-300 font-medium transition-colors">Sign Up</a>
                <a href="/login" class="text-white hover:text-emerald-300 font-medium transition-colors">Log In</a>
            {% endif %}
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="p-8 flex-grow flex flex-col items-center">
        <div class="max-w-4xl w-full">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">
                {% if session["user_type"] == "volunteer" %}
                    My Event Signups
                {% else %}
                    Signups for Our Events
                {% endif %}
            </h2>

            {% if signups %}
                <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200 overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-700">
                        <thead class="text-xs text-gray-500 uppercase table-header">
                            <tr>
                                {% if session["user_type"] == "volunteer" %}
                                    <th scope="col">Event</th>
                                    <th scope="col">Role</th>
                                    <th scope="col">Organisation</th>
                                    <th scope="col">Date</th>
                                {% else %}
                                    <th scope="col">Volunteer (Click to View Profile)</th>
                                    <th scope="col">Event</th>
                                    <th scope="col">Role</th>
                                {% endif %}
                                <th scope="col">Status</th>
                                {% if session["user_type"] == "organisation" %}
                                    <th scope="col">Action</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for signup in signups %}
                                <tr class="bg-white table-row transition-all duration-150 hover:bg-gray-50">
                                    {% if session["user_type"] == "volunteer" %}
                                        <td class="font-medium text-gray-900">{{ signup.event_name }}</td>
                                        <td>{{ signup.role_name }}</td>
                                        <td>{{ signup.organisation_name }}</td>
                                        <td>{{ signup.event_date }}</td>
                                    {% else %}
                                        <td class="font-medium text-blue-600 hover:text-blue-800">
                                            <a href="{{ url_for('view_volunteer', volunteer_id=signup.volunteerID) }}">
                                                {{ signup.volunteer_name }}
                                            </a>
                                        </td>
                                        <td>{{ signup.event_name }}</td>
                                        <td>{{ signup.role_name }}</td>
                                    {% endif %}
                                    <td>
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold
                                            {% if signup.status == 'Pending' %}
                                                bg-yellow-100 text-yellow-800
                                            {% elif signup.status == 'Accepted' %}
                                                bg-green-100 text-green-800
                                            {% elif signup.status == 'Rejected' %}
                                                bg-red-100 text-red-800
                                            {% endif %}">
                                            {{ signup.status }}
                                        </span>
                                    </td>
                                    {% if session["user_type"] == "organisation" %}
                                        <td>
                                            <div class="flex space-x-2">
                                                <button onclick="updateStatus('{{ signup.id }}', 'Accepted')" class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold hover:bg-green-600 transition-colors">
                                                    Accept
                                                </button>
                                                <button onclick="updateStatus('{{ signup.id }}', 'Rejected')" class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-semibold hover:bg-red-600 transition-colors">
                                                    Reject
                                                </button>
                                            </div>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center p-8 bg-white rounded-2xl shadow-lg border border-gray-200">
                    <p class="text-gray-500 text-lg">
                        {% if session["user_type"] == "volunteer" %}
                            You have not signed up for any events yet. <a href="{{ url_for('events') }}" class="text-emerald-500 hover:underline font-semibold">Browse events here!</a>
                        {% else %}
                            There are no signups for your events yet.
                        {% endif %}
                    </p>
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 text-center mt-auto shadow-inner rounded-t-xl">
        <p>&copy; 2025 Volunteer Management System</p>
    </footer>

    <!-- JavaScript for updating signup status via AJAX -->
    <script>
        async function updateStatus(signupId, status) {
            try {
                const response = await fetch('/update_signup_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ signup_id: signupId, status: status }),
                });

                if (response.ok) {
                    // Refresh the page to show the updated status
                    window.location.reload();
                } else {
                    const error = await response.json();
                    console.error('Failed to update status:', error.error);
                    alert('Failed to update status: ' + error.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        }
    </script>
</body>
</html>
